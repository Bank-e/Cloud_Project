<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - Cat Excalibur</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>
    <div class="navbar" id="main-navbar"></div>

    <div class="container">
        <div class="card" style="text-align: center;">
            <div class="logo" style="margin: 0 auto 30px;">üêæ</div>
            <h2 style="text-align: center; margin-bottom: 30px;">Register</h2>
            
            <form id="registerForm">
                <div class="form-group">
                    <input type="text" class="form-input" placeholder="Username" required>
                </div>
                <div class="form-group">
                    <input type="password" class="form-input" placeholder="Password" required>
                </div>
                <div class="form-group">
                    <input type="password" class="form-input" placeholder="Confirm Password" required>
                </div>
                <div class="form-group">
                    <input type="text" class="form-input" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="tel" class="form-input" placeholder="Tel" required>
                </div>
                
                <button type="submit" class="btn btn-primary">Register</button>
            </form>
        </div>
    </div>

    <script>
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
        const username = document.querySelector('input[placeholder="Username"]').value;
        const password = document.querySelector('input[placeholder="Password"]').value;
        const confirmPass = document.querySelector('input[placeholder="Confirm Password"]').value;
        const email = document.querySelector('input[placeholder="Email"]').value;
        const phone = document.querySelector('input[placeholder="Tel"]').value;

        if (password !== confirmPass) {
            alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');
            return;
        }

        // 2. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î API Endpoint ‡∏à‡∏≤‡∏Å "config API gateway.json"
        const BASE_API_URL = 'https://wpvr9cxmmj.execute-api.us-east-1.amazonaws.com/Cat_Excalibur';
        const API_URL = `${BASE_API_URL}/register`;

        // 3. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà Lambda "register_user.py" ‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á)
        const payload = {
            username: username,
            password: password,
            email: email,
            phoneNumber: phone // Lambda ‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á 'phoneNumber'
        };

        try {
            // 4. ‡∏™‡πà‡∏á Request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á API Gateway
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();

            if (response.ok) {
                // 5. ‡∏´‡∏≤‡∏Å Lambda (register_user.py) ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                alert(result.message || '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                window.location.href = 'login.html'; // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login
            } else {
                // 6. ‡∏´‡∏≤‡∏Å Lambda ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ error (‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥)
                alert('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + (result.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ'));
            }
        } catch (error) {
            console.error('Error:', error);
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
        }
    });
    </script>
    <script src="assets/js/navbar-generator.js"></script>
</body>
</html>